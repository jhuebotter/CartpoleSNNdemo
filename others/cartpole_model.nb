(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     50377,       1126]
NotebookOptionsPosition[     47525,       1077]
NotebookOutlinePosition[     47958,       1094]
CellTagsIndexPosition[     47915,       1091]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\<\
This notebook contains equations used currently in CartPole simulator. 

The convention:\[LineSeparator]\tPole upright position defines 0 angle
\tCart movement to the right is positive
\tClockwise angle rotation is defined as negative

Coincide with \
https://sharpneat.sourceforge.io/research/cart-pole/cart-pole-equations.html \
up to the angle-direction-convention and notation changes.
(The friction terms not compared attentively but calculated and checked \
carefully)\
\>", "Text",
 CellChangeTimes->{{3.800377202058222*^9, 3.80037726473081*^9}, {
  3.821372681144129*^9, 3.821372693529894*^9}, {3.821373137768483*^9, 
  3.821373194594351*^9}, {3.821373250706255*^9, 3.821373315609631*^9}, {
  3.821373358328562*^9, 3.8213733905445013`*^9}, {3.821418851847025*^9, 
  3.821418863031933*^9}, {3.821419117421077*^9, 3.82141916722785*^9}, {
  3.821419458095592*^9, 3.8214194680275373`*^9}, {3.82187130287224*^9, 
  3.8218714583023987`*^9}},ExpressionUUID->"ec91ef16-069f-48b2-a28e-\
a4775a03f67b"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"You", " ", "can", " ", "set", " ", "numerical", " ", "values"}], 
    " ", "-", " ", 
    RowBox[{
     RowBox[{"e", ".", "g", ".", " ", "to"}], " ", "find", " ", "right", " ", 
     "control", " ", 
     RowBox[{"matrix", ".", " ", "Always"}], " ", "check", " ", "if", " ", 
     "they", " ", "are", " ", "the", " ", "same", " ", "as", " ", "in", " ", 
     "your", " ", "python", " ", 
     RowBox[{"simulator", "!"}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"l", "=", "1.0"}], ";", "   ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"HALF", " ", "length", " ", "of", " ", "the", " ", "pole"}], 
      ",", " ", "m"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     SubscriptBox["m", "p"], "=", "2.0"}], ";", "  ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"mass", " ", "of", " ", "the", " ", "pole"}], ",", " ", "kg"}], 
     "*)"}], "\n", 
    RowBox[{
     SubscriptBox["m", "c"], "=", "1.0"}], " ", ";", "  ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"mass", " ", "of", " ", "the", " ", "cart"}], ",", " ", "kg"}], 
     "*)"}], "\n", 
    RowBox[{
     SubscriptBox["\[Mu]", "c"], "=", "1.0"}], " ", ";", "  ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"cart", " ", "friction"}], ",", " ", 
      RowBox[{
       RowBox[{"N", "/", "m"}], "/", "s"}]}], "*)"}], "\n", 
    RowBox[{
     SubscriptBox["\[Mu]", "p"], "=", "2.0"}], " ", ";", "  ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "friction", " ", "coefficient", " ", "on", " ", "angular", " ", 
       "velocity"}], ",", " ", 
      RowBox[{
       RowBox[{"Nm", "/", "rad"}], "/", "s"}]}], "*)"}], "\n", 
    RowBox[{"g", "=", "9.81"}], " ", ";", "  ", 
    RowBox[{"(*", 
     RowBox[{"gravity", ",", " ", 
      RowBox[{"m", "/", 
       SuperscriptBox["s", "2"]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"k", " ", "=", " ", 
     RowBox[{"4.0", "/", "3.0"}]}], " ", ";", " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Pole", " ", "momement", " ", "of", " ", 
       RowBox[{"inertia", ":", " ", "I"}]}], "=", 
      RowBox[{"k", "*", 
       SubscriptBox["m", "p"], "*", 
       SuperscriptBox["l", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
        "with", " ", "l", " ", "being", " ", "half", " ", "the", " ", 
         "length", " ", "of", " ", "the", " ", "pole"}], ")"}]}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "yx", " ", "is", " ", "a", " ", "derivative", " ", "od", " ", "x", " ", 
      RowBox[{"(", "position", ")"}], " ", "and", " ", "so", " ", 
      RowBox[{"on", ".", " ", "This"}], " ", "is", " ", "the", " ", "set", 
      " ", "of", " ", "first", " ", "order", " ", "differential", " ", 
      "equations", " ", "describing", " ", "UNDRIVEN", " ", "CartPole", " ", 
      "dynamics"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", "\[IndentingNewLine]", "  ", 
     RowBox[{"x", " ", "-", " ", 
      RowBox[{"cart", " ", "position", "\[IndentingNewLine]", "v"}], " ", "-",
       " ", 
      RowBox[{
      "cart", " ", "speed", "\[IndentingNewLine]", "t", " ", "or", " ", 
       "\[Theta]"}], " ", "-", " ", 
      RowBox[{
      "\"\<theta\>\"", " ", "angle", " ", "of", " ", "the", " ", "pole", 
       "\[IndentingNewLine]", "o", " ", "or", " ", "\[Omega]"}], " ", "-", 
      " ", 
      RowBox[{
      "\"\<omega\>\"", " ", "angular", " ", "velocity", " ", "of", " ", "the",
        " ", "pole", "\[IndentingNewLine]", "u"}], " ", "-", " ", 
      RowBox[{"force", " ", "acting", " ", "on", " ", "the", " ", "cart"}]}], 
     "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Helper", " ", "function"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "[", "\[Theta]_", "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"k", "+", "1"}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["m", "c"], "+", 
         SubscriptBox["m", "p"]}], ")"}]}], "-", 
      RowBox[{
       SubscriptBox["m", "p"], "*", 
       SuperscriptBox[
        RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yx", "[", 
      RowBox[{
      "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ",
        "u_"}], "]"}], ":=", "v"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"yv", "[", 
     RowBox[{
     "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ", 
      "u_"}], "]"}], ":=", "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", "   ", 
         RowBox[{
          RowBox[{"+", " ", 
           RowBox[{"(", 
            RowBox[{
             SubscriptBox["m", "p"], "*", "g", "*", 
             RowBox[{"Cos", "[", "\[Theta]", "]"}], "*", 
             RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ")"}]}], "  ", 
          RowBox[{"(*", 
           RowBox[{
           "Movement", " ", "of", " ", "the", " ", "cart", " ", "due", " ", 
            "to", " ", "gravity"}], "*)"}], "\[IndentingNewLine]", "+", " ", 
          RowBox[{"(", 
           RowBox[{
            SubscriptBox["\[Mu]", "p"], "*", "\[Omega]", "*", 
            RowBox[{
             RowBox[{"Cos", "[", "\[Theta]", "]"}], "/", "l"}]}], ")"}], " ", 
          
          RowBox[{"(*", 
           RowBox[{
           "Movement", " ", "of", " ", "the", " ", "cart", " ", "due", " ", 
            "to", " ", 
            RowBox[{"pole", "'"}], "s", " ", "friction", " ", "in", " ", 
            "the", " ", "joint"}], "*)"}], "\[IndentingNewLine]", "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"k", "+", "1"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{
             SubscriptBox["m", "p"], "*", "l", "*", 
             SuperscriptBox["\[Omega]", "2"], "*", 
             RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ")"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Keeps", " ", "the", " ", "Cart"}], "-", 
            RowBox[{
            "Pole", " ", "center", " ", "of", " ", "mass", " ", "fixed", " ", 
             "when", " ", "pole", " ", "rotates"}]}], "*)"}], 
          "\[IndentingNewLine]", "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"k", "+", "1"}], ")"}], "*", 
           SubscriptBox["\[Mu]", "c"], "*", "v"}]}], " ", 
         RowBox[{"(*", 
          RowBox[{
          "Braking", " ", "of", " ", "the", " ", "cart", " ", "due", " ", 
           "to", " ", "its", " ", "friction", " ", "on", " ", "the", " ", 
           "track"}], "*)"}], "\[IndentingNewLine]", "\t", ")"}], "/", 
        RowBox[{"A", "[", "\[Theta]", "]"}]}], ")"}], ")"}], " ", "+", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k", "+", "1"}], ")"}], "/", 
        RowBox[{"A", "[", "\[Theta]", "]"}]}], ")"}], "*", "u"}]}]}], " ", 
   RowBox[{"(*", 
    RowBox[{
    "Effect", " ", "of", " ", "force", " ", "applied", " ", "to", " ", "the", 
     " ", "cart"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"yt", "[", 
      RowBox[{
      "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ",
        "u_"}], "]"}], ":=", "\[Omega]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"yo", "[", 
      RowBox[{
      "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ",
        "u_"}], "]"}], ":=", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", "\[IndentingNewLine]", "  ", 
         RowBox[{
          RowBox[{
           RowBox[{"+", " ", "g"}], "*", 
           RowBox[{"(", 
            RowBox[{
             SubscriptBox["m", "c"], "+", 
             SubscriptBox["m", "p"]}], ")"}], "*", 
           RowBox[{"Sin", "[", "\[Theta]", "]"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{
           "Movement", " ", "of", " ", "the", " ", "pole", " ", "due", " ", 
            "to", " ", "gravity"}], "*)"}], "\[IndentingNewLine]", "-", 
          RowBox[{"(", 
           RowBox[{
            SubscriptBox["\[Mu]", "p"], "*", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["m", "c"], "+", 
              SubscriptBox["m", "p"]}], ")"}], "*", 
            RowBox[{"\[Omega]", "/", 
             RowBox[{"(", 
              RowBox[{"l", "*", 
               SubscriptBox["m", "p"]}], ")"}]}]}], ")"}], " ", 
          RowBox[{"(*", 
           RowBox[{
           "Braking", " ", "of", " ", "the", " ", "pole", " ", "due", " ", 
            "to", " ", "friction", " ", "in", " ", "its", " ", "joint"}], 
           "*)"}], "\[IndentingNewLine]", "-", " ", 
          RowBox[{
           SubscriptBox["m", "p"], "*", "l", "*", 
           SuperscriptBox["\[Omega]", "2"], "*", 
           RowBox[{"Sin", "[", "\[Theta]", "]"}], "*", 
           RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "  ", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Keeps", " ", "the", " ", "Cart"}], "-", 
            RowBox[{
            "Pole", " ", "center", " ", "of", " ", "mass", " ", "fixed", " ", 
             "when", " ", "pole", " ", "rotates"}]}], "*)"}], 
          "\[IndentingNewLine]", "-", " ", 
          RowBox[{
           RowBox[{"Cos", "[", "\[Theta]", "]"}], "*", 
           SubscriptBox["\[Mu]", "c"], "*", "v"}]}], "   ", 
         RowBox[{"(*", 
          RowBox[{
          "Friction", " ", "of", " ", "the", " ", "cart", " ", "on", " ", 
           "the", " ", "track", " ", "causing", " ", "deceleration", " ", 
           "of", " ", "cart", " ", "and", " ", "acceleration", " ", "of", " ",
            "pole", " ", "in", " ", "opposite", " ", "direction", " ", "due", 
           " ", "to", " ", "intertia"}], "*)"}], "\[IndentingNewLine]", "\t", 
         ")"}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"A", "[", "\[Theta]", "]"}], "*", "l"}], ")"}]}], ")"}], 
      "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Cos", "[", "\[Theta]", "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"A", "[", "\[Theta]", "]"}], "*", "l"}], ")"}]}], ")"}], 
       "*", "u"}]}]}], " ", ";", "   ", 
    RowBox[{"(*", 
     RowBox[{
     "Effect", " ", "of", " ", "force", " ", "applied", " ", "to", " ", 
      "cart"}], "*)"}], "\[IndentingNewLine]"}]}]}]], "Input",
 CellChangeTimes->{{3.8003695615035963`*^9, 3.8003697700324717`*^9}, {
   3.800369817004998*^9, 3.800370094112015*^9}, {3.800370209894107*^9, 
   3.800370236293747*^9}, {3.800374495498096*^9, 3.800374657580276*^9}, {
   3.800374691232482*^9, 3.8003748693282022`*^9}, {3.800374945698048*^9, 
   3.80037496050806*^9}, 3.8003756281579447`*^9, 3.8003771912919807`*^9, {
   3.800377281959076*^9, 3.800377369272848*^9}, {3.800377892585887*^9, 
   3.8003779164286118`*^9}, {3.8003779850213213`*^9, 3.800378023692821*^9}, {
   3.800378073778905*^9, 3.8003782212943*^9}, {3.800531270530734*^9, 
   3.800531291468087*^9}, {3.8213725585958548`*^9, 3.821372609226412*^9}, {
   3.821372739730607*^9, 3.821372896012995*^9}, {3.821372926142087*^9, 
   3.821372976982112*^9}, {3.821373104480197*^9, 3.821373110756583*^9}, {
   3.821373535454173*^9, 3.821373672134616*^9}, {3.8213737022632017`*^9, 
   3.821373778570096*^9}, {3.821373837932042*^9, 3.82137386851164*^9}, {
   3.821373925619935*^9, 3.8213739492312107`*^9}, {3.821374026911478*^9, 
   3.821374027207869*^9}, {3.821374122548955*^9, 3.8213741442477818`*^9}, {
   3.821374379175273*^9, 3.8213744402117033`*^9}, {3.8213745279977083`*^9, 
   3.821374541929093*^9}, {3.8213751351904182`*^9, 3.821375172556929*^9}, {
   3.821376811145775*^9, 3.821376813683299*^9}, {3.8213768650439672`*^9, 
   3.8213768717202*^9}, {3.821377849180214*^9, 3.821377861095607*^9}, {
   3.821377965729547*^9, 3.821377995187293*^9}, {3.821378221313745*^9, 
   3.821378225749165*^9}, {3.821378677457329*^9, 3.8213786809319677`*^9}, {
   3.821409799927685*^9, 3.8214098373784647`*^9}, {3.821409867881295*^9, 
   3.821409890993161*^9}, {3.8214187215606117`*^9, 3.821418813873148*^9}, {
   3.821418880590534*^9, 3.8214190567782183`*^9}, {3.821419172340684*^9, 
   3.821419411639729*^9}, {3.821420121594038*^9, 3.8214201284379787`*^9}, {
   3.82142063000317*^9, 3.821420783218584*^9}, {3.821420817955001*^9, 
   3.821420863989122*^9}, {3.8214209212874937`*^9, 3.8214209251081877`*^9}, {
   3.821421190337008*^9, 3.821421195287126*^9}, {3.821421319375588*^9, 
   3.821421321430779*^9}, {3.82142135260817*^9, 3.821421353327795*^9}, {
   3.8214215106585484`*^9, 3.821421518506277*^9}, {3.821421600227373*^9, 
   3.8214217756763687`*^9}, {3.8214218304106483`*^9, 3.821421831560762*^9}, {
   3.82142187916044*^9, 3.8214219062853117`*^9}, {3.821421977361573*^9, 
   3.821421987803775*^9}, 3.821422268955021*^9, {3.821422299830059*^9, 
   3.82142233879397*^9}, {3.821426366851268*^9, 3.821426394856207*^9}, {
   3.821426637576035*^9, 3.821426638207818*^9}, {3.8214266811979427`*^9, 
   3.821426690389517*^9}, {3.821427027396214*^9, 3.8214270760654917`*^9}, {
   3.8214273536809*^9, 3.8214273688357067`*^9}, {3.821428060176117*^9, 
   3.821428071345202*^9}, {3.821429055279747*^9, 3.8214290666901217`*^9}, {
   3.821429103310858*^9, 3.821429148797461*^9}, {3.821429246199675*^9, 
   3.8214293034198313`*^9}, {3.8214297306224947`*^9, 3.821429753692218*^9}, {
   3.82142979358176*^9, 3.821429801437316*^9}, {3.821430083277136*^9, 
   3.8214301049529467`*^9}, {3.821430186937886*^9, 3.821430302419201*^9}, {
   3.8214303907422037`*^9, 3.821430394517702*^9}, {3.8214305275181847`*^9, 
   3.8214305541162987`*^9}, {3.821430614838352*^9, 3.821430640263012*^9}, {
   3.821430702009713*^9, 3.821430740265036*^9}, {3.821430773217247*^9, 
   3.821430790857766*^9}, {3.821430843674879*^9, 3.821430885107244*^9}, {
   3.821430916253296*^9, 3.82143096449516*^9}, {3.82143128127109*^9, 
   3.821431468965691*^9}, {3.8214315232325163`*^9, 3.8214315310505333`*^9}, {
   3.8214324995071287`*^9, 3.821432519354059*^9}, {3.821446573425294*^9, 
   3.821446663625045*^9}, {3.821446774880825*^9, 3.821446802731839*^9}, {
   3.821446886675088*^9, 3.821446902466125*^9}, 3.821447507957361*^9, 
   3.821447625829577*^9, 3.821447809940358*^9, 3.821493305788517*^9, {
   3.821493435807589*^9, 3.8214934374107513`*^9}, 3.821849550765415*^9, 
   3.8218516847127333`*^9, 3.821852116697109*^9, 3.821853277773526*^9, 
   3.821853773134034*^9, 3.821854319318902*^9, 3.821854566620934*^9, 
   3.821854846933135*^9, 3.821855063951193*^9, {3.821855615756528*^9, 
   3.821855664464074*^9}, {3.821855945839469*^9, 3.821855967657852*^9}, 
   3.821859141000115*^9, 3.821859183901435*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"c7722910-f3b0-4675-964e-01f4d4cdef49"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8214309844896793`*^9, 3.821430990754044*^9}, {
   3.821446906879828*^9, 3.8214469072599363`*^9}, 3.821496041396492*^9},
 CellLabel->"In[6]:=",ExpressionUUID->"ca78a879-afda-42fa-a41f-470ecb58234f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Here", " ", "we", " ", "calculate", " ", "the", " ", "gradient", " ", 
    "of", " ", "the", " ", "functions", " ", "with", " ", "the", " ", "aim", 
    " ", "to", " ", "linearize", " ", "around", " ", "equilibrium", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Pole", " ", "up"}], ",", " ", 
      RowBox[{
       RowBox[{"that", " ", "is", " ", "\[Theta]"}], " ", "=", " ", "0"}], 
      ",", " ", 
      RowBox[{"\[Omega]", " ", "=", " ", "0"}], ",", " ", 
      RowBox[{"v", " ", "=", " ", "0"}], ",", " ", 
      RowBox[{"result", " ", "is", " ", "independent", " ", "of", " ", "x"}], 
      " ", ",", " ", 
      RowBox[{
       RowBox[{"we", " ", "set", " ", "x"}], " ", "=", " ", "0"}]}], ")"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"yxGrad", "[", 
      RowBox[{
      "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ",
        "u_"}], "]"}], " ", "=", " ", 
     RowBox[{"Grad", "[", 
      RowBox[{
       RowBox[{"yx", "[", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yvGrad", "[", 
      RowBox[{
      "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ",
        "u_"}], "]"}], " ", "=", " ", 
     RowBox[{"Grad", "[", 
      RowBox[{
       RowBox[{"yv", "[", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ytGrad", "[", 
      RowBox[{
      "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ",
        "u_"}], "]"}], " ", "=", " ", 
     RowBox[{"Grad", "[", 
      RowBox[{
       RowBox[{"yt", "[", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yoGrad", "[", 
      RowBox[{
      "x_", ",", " ", "v_", ",", "\[Theta]_", ",", " ", "\[Omega]_", ",", " ",
        "u_"}], "]"}], " ", "=", " ", 
     RowBox[{"Grad", "[", 
      RowBox[{
       RowBox[{"yo", "[", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{
        "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
         "u"}], "}"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.800370118471074*^9, {3.800377380521537*^9, 3.800377486206111*^9}, {
   3.821427274451008*^9, 3.821427283833364*^9}, {3.821427317961982*^9, 
   3.821427318310161*^9}, {3.821428074622479*^9, 3.821428100813656*^9}, {
   3.821428187017414*^9, 3.8214281932111588`*^9}, {3.821429317810175*^9, 
   3.821429346435419*^9}, 3.821429383539613*^9, {3.821429431808433*^9, 
   3.821429440320006*^9}, {3.821429805756092*^9, 3.821429837799884*^9}, {
   3.8214301081834993`*^9, 3.82143013431462*^9}, {3.821431035650037*^9, 
   3.821431037308028*^9}, {3.8214467303265257`*^9, 3.8214467535765944`*^9}, {
   3.821446850978994*^9, 3.821446877766933*^9}, 3.821495554279056*^9},
 CellLabel->"In[7]:=",ExpressionUUID->"e6cc7a8f-e013-41b6-a344-daca8d490ae3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Jrow1", " ", "=", " ", 
   RowBox[{"yxGrad", "[", 
    RowBox[{
    "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
     "u"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Jrow2", " ", "=", " ", 
   RowBox[{"yvGrad", "[", 
    RowBox[{
    "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
     "u"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Jrow3", " ", "=", " ", 
   RowBox[{"ytGrad", "[", 
    RowBox[{
    "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
     "u"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Jrow4", " ", "=", " ", 
   RowBox[{"yoGrad", "[", 
    RowBox[{
    "x", ",", " ", "v", ",", "\[Theta]", ",", " ", "\[Omega]", ",", " ", 
     "u"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{
  3.800370161602797*^9, {3.800375588915625*^9, 3.800375610426709*^9}, {
   3.82142236114155*^9, 3.8214223825809097`*^9}, {3.8214225965444403`*^9, 
   3.8214226044142523`*^9}, {3.821426167056534*^9, 3.821426184581904*^9}, {
   3.821428102347969*^9, 3.821428107985216*^9}, {3.821429349949332*^9, 
   3.821429352734611*^9}, {3.8214297144719553`*^9, 3.821429717417178*^9}, {
   3.821429840832896*^9, 3.821429847289612*^9}, {3.8214301495309563`*^9, 
   3.8214301606060877`*^9}, 3.821431089099773*^9, {3.821446717675048*^9, 
   3.8214467262606287`*^9}, {3.821446838443346*^9, 3.821446844456191*^9}, 
   3.821495548700451*^9},
 CellLabel->"In[11]:=",ExpressionUUID->"3da3870a-8e6e-4c0c-9a4c-a1a216d8a606"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.8003755807093897`*^9, 3.800375584112253*^9}, {
   3.8003756434731817`*^9, 3.80037568934202*^9}, {3.800375779875313*^9, 
   3.800375782837565*^9}, {3.800376504385106*^9, 3.800376511872789*^9}, {
   3.8003769555199423`*^9, 3.8003769595466547`*^9}, {3.800377495754417*^9, 
   3.800377520672282*^9}, {3.800378786482226*^9, 3.800378790501437*^9}, {
   3.821425159596651*^9, 3.821425190935845*^9}, 3.821425235705306*^9, {
   3.821425530330091*^9, 3.821425664585881*^9}, {3.8214259954123*^9, 
   3.821426040150959*^9}, {3.821426078762155*^9, 3.821426106821505*^9}, {
   3.8214261782374687`*^9, 3.8214262178960533`*^9}, {3.821428142652945*^9, 
   3.821428155101503*^9}, {3.821429662008176*^9, 3.821429670884941*^9}, {
   3.821429856205455*^9, 3.8214298565464897`*^9}, {3.8214299385079727`*^9, 
   3.821429989891644*^9}, {3.821430044890314*^9, 3.821430049299451*^9}, {
   3.821446694301609*^9, 3.821446707660306*^9}, {3.821446792541095*^9, 
   3.8214467930985537`*^9}, {3.8214468288743067`*^9, 3.8214468312129707`*^9}, 
   3.821495540043891*^9, 3.821495608486809*^9, {3.8214958899777412`*^9, 
   3.8214958974529133`*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"cf85ab20-42c3-49aa-ad10-a57d6f6d2187"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.821430828495846*^9, 3.821446967490082*^9},
 CellLabel->"In[16]:=",ExpressionUUID->"64b2b300-ae4d-4232-b82e-2a6b5e7024e5"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Compose", " ", "Jacobian"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"JCartPole", "=", " ", 
       RowBox[{"{", 
        RowBox[{"Jrow1", ",", "Jrow2", ",", " ", "Jrow3", ",", " ", "Jrow4"}],
         "}"}]}], ")"}], "//", "MatrixForm"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"myCols", " ", "=", " ", 
    RowBox[{
     RowBox[{"ArrayReshape", " ", "[", 
      RowBox[{
       RowBox[{"JCartPole", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", " ", "1"}], "}"}]}], "]"}], "//", "MatrixForm"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.821446965761848*^9, 3.82144696576229*^9}, 
   3.821495906037711*^9, 3.821840552308597*^9, {3.821840595249998*^9, 
   3.821840657640723*^9}, {3.8218407500300913`*^9, 3.821840816291155*^9}, {
   3.8218415360774517`*^9, 3.821841552030718*^9}, {3.821841595885228*^9, 
   3.821841596108542*^9}, {3.821841775750395*^9, 3.821841775823163*^9}, {
   3.821847080756028*^9, 3.8218470808578243`*^9}, {3.821851696961837*^9, 
   3.821851764899251*^9}, {3.821853303966845*^9, 3.8218533230995693`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"2563e24a-08ee-4a8f-9570-719da7f728fa"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0"},
     {
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{"9.333333333333332`", " ", "u", " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"6.999999999999999`", "\[VeryThinSpace]", "-", 
            RowBox[{"2.`", " ", 
             SuperscriptBox[
              RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}], ")"}], "2"]]}],
        "-", 
       FractionBox[
        RowBox[{"4.`", " ", 
         RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "2.333333333333333`"}], " ", "v"}], "+", 
           RowBox[{"2.`", " ", "\[Omega]", " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
           RowBox[{"4.666666666666666`", " ", 
            SuperscriptBox["\[Omega]", "2"], " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
           RowBox[{"19.62`", " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ")"}]}], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"6.999999999999999`", "\[VeryThinSpace]", "-", 
           RowBox[{"2.`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}], ")"}], "2"]], 
       "+", 
       FractionBox[
        RowBox[{
         RowBox[{
          RowBox[{"-", "4.666666666666666`"}], " ", 
          SuperscriptBox["\[Omega]", "2"], " ", 
          RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
         RowBox[{"19.62`", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}], "-", 
         RowBox[{"2.`", " ", "\[Omega]", " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
         RowBox[{"19.62`", " ", 
          SuperscriptBox[
           RowBox[{"Sin", "[", "\[Theta]", "]"}], "2"]}]}], 
        RowBox[{"6.999999999999999`", "\[VeryThinSpace]", "-", 
         RowBox[{"2.`", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]]}]},
     {"0"},
     {
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{"4.`", " ", "u", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"], " ", 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]}], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"6.999999999999999`", "\[VeryThinSpace]", "-", 
            RowBox[{"2.`", " ", 
             SuperscriptBox[
              RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}], ")"}], "2"]]}],
        "-", 
       FractionBox[
        RowBox[{"1.`", " ", "u", " ", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}], 
        RowBox[{"6.999999999999999`", "\[VeryThinSpace]", "-", 
         RowBox[{"2.`", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]], "-", 
       FractionBox[
        RowBox[{"4.`", " ", 
         RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "3.`"}], " ", "\[Omega]"}], "-", 
           RowBox[{"1.`", " ", "v", " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
           RowBox[{"29.43`", " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "-", 
           RowBox[{"2.`", " ", 
            SuperscriptBox["\[Omega]", "2"], " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ")"}]}], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"6.999999999999999`", "\[VeryThinSpace]", "-", 
           RowBox[{"2.`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}], ")"}], "2"]], 
       "+", 
       FractionBox[
        RowBox[{"1.`", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"29.43`", " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", 
           RowBox[{"2.`", " ", 
            SuperscriptBox["\[Omega]", "2"], " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}], "+", 
           RowBox[{"1.`", " ", "v", " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
           RowBox[{"2.`", " ", 
            SuperscriptBox["\[Omega]", "2"], " ", 
            SuperscriptBox[
             RowBox[{"Sin", "[", "\[Theta]", "]"}], "2"]}]}], ")"}]}], 
        RowBox[{"6.999999999999999`", "\[VeryThinSpace]", "-", 
         RowBox[{"2.`", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]]}]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.821496032449025*^9, 3.821496047067724*^9}, {
   3.82184061489603*^9, 3.821840660705414*^9}, 3.821840705530396*^9, {
   3.82184076237087*^9, 3.821840836811585*^9}, {3.8218415411811857`*^9, 
   3.8218415562871027`*^9}, 3.821841600390798*^9, 3.8218417795645514`*^9, 
   3.821847087606081*^9, 3.8218495571510143`*^9, {3.821851704271364*^9, 
   3.821851727809813*^9}, 3.8218517674105787`*^9, 3.8218521224209557`*^9, 
   3.8218523725719624`*^9, 3.8218529015953817`*^9, 3.821852952236534*^9, 
   3.821853070014657*^9, 3.821853129039154*^9, 3.821853281898892*^9, {
   3.8218533138790503`*^9, 3.821853331526884*^9}, {3.821853778871978*^9, 
   3.821853789444322*^9}, 3.8218538485872927`*^9, 3.821854014417444*^9, 
   3.821854336913376*^9, 3.821854578029097*^9, 3.821854636381122*^9, 
   3.8218546826762047`*^9, 3.821854758126045*^9, 3.8218548688169737`*^9, 
   3.8218550912928143`*^9, 3.821855140826623*^9, 3.821855271251985*^9, 
   3.82185566958189*^9, 3.821855985771926*^9, 3.821859188748136*^9},
 CellLabel->
  "Out[18]//MatrixForm=",ExpressionUUID->"d7cfc8fa-b68d-4445-baab-\
5dac82ceff8f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Evaluate", " ", "Jacobian", " ", "at", " ", "point", " ", "of", " ", 
    "interest"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"JCartPole", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"v", "\[Rule]", "0"}], ",", 
        RowBox[{"\[Theta]", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"\[Omega]", "\[Rule]", "0"}], ",", " ", 
        RowBox[{"u", "\[Rule]", "0"}]}], "}"}]}], "//", "MatrixForm"}], ";"}],
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"JCartPole", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "\[Rule]", 
       RowBox[{"-", "30.2"}]}], ",", " ", 
      RowBox[{"v", "\[Rule]", "2.87"}], ",", 
      RowBox[{"\[Theta]", "\[Rule]", 
       RowBox[{"-", "0.32"}]}], ",", " ", 
      RowBox[{"\[Omega]", "\[Rule]", "0.237"}], ",", " ", 
      RowBox[{"u", "\[Rule]", 
       RowBox[{"-", "0.24"}]}]}], "}"}]}], "//", "MatrixForm"}]}]], "Input",
 CellChangeTimes->{
  3.8214228305005083`*^9, 3.821495891753474*^9, 3.821840818380204*^9, {
   3.8218528300596943`*^9, 3.821852831071237*^9}, {3.821852862922023*^9, 
   3.821852882818163*^9}, {3.821852935668841*^9, 3.8218529359559603`*^9}, {
   3.821852993658991*^9, 3.821852997676548*^9}, 3.821853123849928*^9, {
   3.821853842634102*^9, 3.82185384463367*^9}, 3.82185396742525*^9, {
   3.82185462981697*^9, 3.82185463245232*^9}, {3.8218547531590776`*^9, 
   3.8218547537418547`*^9}, {3.821854838841401*^9, 3.8218548390538397`*^9}, {
   3.8218550860161*^9, 3.821855086133617*^9}, {3.821855136410439*^9, 
   3.821855136681407*^9}, {3.821855266608033*^9, 3.82185526684426*^9}},
 NumberMarks->False,
 CellLabel->"In[19]:=",ExpressionUUID->"9d38b20d-5c57-40a4-812d-f344a662c428"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "1", "0", "0", "0"},
     {"0", 
      RowBox[{"-", "0.448898868591622`"}], "2.452161579147473`", 
      "0.4991034746711258`", "0.448898868591622`"},
     {"0", "0", "0", "1", "0"},
     {"0", 
      RowBox[{"-", "0.18261887365898702`"}], "4.599221384707284`", 
      RowBox[{"-", "0.5226970783302373`"}], "0.18261887365898702`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.821852901626751*^9, 3.821852952270249*^9, 3.821853070048438*^9, 
   3.821853129047077*^9, 3.8218532819064837`*^9, {3.821853313948481*^9, 
   3.821853331535625*^9}, {3.821853778881152*^9, 3.821853789451293*^9}, 
   3.8218538485953617`*^9, 3.821854014424962*^9, 3.8218543369392643`*^9, 
   3.821854578060749*^9, 3.821854636415411*^9, 3.821854682712411*^9, 
   3.821854758133307*^9, 3.8218548688274593`*^9, 3.8218550913172007`*^9, 
   3.821855140856697*^9, 3.8218552712609587`*^9, 3.821855669590384*^9, 
   3.821855985796543*^9, 3.821859188754265*^9},
 CellLabel->
  "Out[19]//MatrixForm=",ExpressionUUID->"fe28630d-fcf3-4bda-87bc-\
10258f281217"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Another", " ", "way", " ", "to", " ", "form", " ", "Jacobian", " ", 
    RowBox[{"(", 
     RowBox[{"just", " ", "for", " ", "testing"}], ")"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Jrow1", " ", "=", " ", 
     RowBox[{"yxGrad", "[", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Jrow2", " ", "=", " ", 
     RowBox[{"yvGrad", "[", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Jrow3", " ", "=", " ", 
     RowBox[{"ytGrad", "[", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", " ", "0"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Jrow4", " ", "=", " ", 
     RowBox[{"yoGrad", "[", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", " ", "0"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Create", " ", "Jacobian", " ", "at", " ", "equilibrium"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"JCartPole", "=", " ", 
       RowBox[{"{", 
        RowBox[{"Jrow1", ",", "Jrow2", ",", " ", "Jrow3", ",", " ", "Jrow4"}],
         "}"}]}], ")"}], "//", "MatrixForm"}], ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.821422827852784*^9, {3.82142613163266*^9, 3.821426192339699*^9}, {
   3.8214262288032513`*^9, 3.8214262542585373`*^9}, {3.821426348931539*^9, 
   3.8214263524920588`*^9}, {3.821430435864459*^9, 3.821430451063231*^9}, {
   3.8214472842309103`*^9, 3.821447290729954*^9}, 3.821840827926393*^9, 
   3.821849410891781*^9, {3.821852263588048*^9, 3.8218522814890747`*^9}, {
   3.8218523150560083`*^9, 3.8218523660075483`*^9}, {3.8218526249577627`*^9, 
   3.821852743372233*^9}, {3.821852822368347*^9, 3.821852822835472*^9}, {
   3.821852886159235*^9, 3.821852898310824*^9}, 3.821859175378706*^9},
 NumberMarks->False,
 CellLabel->"In[20]:=",ExpressionUUID->"61a68d14-52e8-4781-9dad-7665c22f2213"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Jacobian", " ", "of", " ", "undriven", " ", "system"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Acontrol", " ", "=", " ", 
     RowBox[{"JCartPole", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", 
        RowBox[{"1", ";;", 
         RowBox[{"-", "2"}]}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Linearization", " ", "of", " ", "control", " ", "input", " ", "effect", 
     " ", "around", " ", "equilibrium"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"B", " ", "=", " ", 
     RowBox[{"ArrayReshape", " ", "[", 
      RowBox[{
       RowBox[{"JCartPole", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", " ", "1"}], "}"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8003759543383617`*^9, 3.800376000768046*^9}, {
  3.80037605170809*^9, 3.800376060325713*^9}, {3.800376407450387*^9, 
  3.800376435143547*^9}, {3.8003765065008*^9, 3.800376518969345*^9}, {
  3.800376665986546*^9, 3.8003766862311153`*^9}, {3.821422467100019*^9, 
  3.821422469409646*^9}, {3.821447053995428*^9, 3.821447054957464*^9}, {
  3.8214471203006783`*^9, 3.8214471425956707`*^9}, {3.821447201596505*^9, 
  3.821447267966474*^9}, {3.821447543783908*^9, 3.821447543837883*^9}, {
  3.821447592862808*^9, 3.821447596571628*^9}, {3.82146735047863*^9, 
  3.821467405955348*^9}, {3.8214679443316517`*^9, 3.821468032350183*^9}, {
  3.8214933340844727`*^9, 3.8214933797510147`*^9}, {3.821493412736266*^9, 
  3.821493415069571*^9}, {3.821840685083951*^9, 3.82184068643323*^9}, {
  3.821840830379548*^9, 3.821840832122734*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"d4f7a19e-8161-47cd-8759-21d92bd641a6"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8003766981657248`*^9, 3.8003767006382113`*^9}, 
   3.8003767366816607`*^9, 3.800376774664843*^9},
 CellLabel->"In[27]:=",ExpressionUUID->"a3b39778-d0eb-482e-a892-b655b50450ec"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Calculate", " ", "Controlability", " ", 
    RowBox[{"matrix", ".", " ", "Long"}], " ", "and", " ", "complicated", " ",
     "hence", " ", "output", " ", "not", " ", "displayed"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"Ctrb", " ", "=", 
     RowBox[{"ControllabilityMatrix", "[", 
      RowBox[{"StateSpaceModel", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Acontrol", ",", "B", ",", " ", 
          RowBox[{"IdentityMatrix", "[", "4", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "0", "}"}], ",", 
            RowBox[{"{", "0", "}"}], ",", 
            RowBox[{"{", "0", "}"}], ",", 
            RowBox[{"{", "0", "}"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"SamplingPeriod", "\[Rule]", "None"}], ",", 
        RowBox[{"SystemsModelLabels", "\[Rule]", "None"}]}], "]"}], "]"}]}], 
    ")"}], "//", "MatrixForm"}]}]], "Input",
 CellChangeTimes->{{3.8003765737188063`*^9, 3.800376583895568*^9}, 
   3.800376625690238*^9, {3.8003766581579638`*^9, 3.800376658784093*^9}, 
   3.800376704913558*^9, {3.80037675192806*^9, 3.80037684661893*^9}, {
   3.800376885585931*^9, 3.8003769159900293`*^9}, {3.800376972945002*^9, 
   3.800376988875814*^9}, {3.8003770477231417`*^9, 3.800377047802843*^9}, 
   3.800377083590415*^9, {3.8003771305472317`*^9, 3.800377141098654*^9}, {
   3.8003775288236513`*^9, 3.8003775708195467`*^9}, 3.8214473874894943`*^9, {
   3.821447791615316*^9, 3.821447795687272*^9}, {3.8214478306637583`*^9, 
   3.821447835162767*^9}, {3.821448076970043*^9, 3.821448081042232*^9}, {
   3.821448136488181*^9, 3.821448146436067*^9}, {3.8214670115807743`*^9, 
   3.8214670199009657`*^9}, {3.8214690492514963`*^9, 3.821469055656012*^9}, 
   3.821469095433867*^9, 3.8218406930801764`*^9},
 CellLabel->"In[28]:=",ExpressionUUID->"dcece8d0-22ba-4f6e-8861-b98a73b9af83"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0", "0.4666666666666667`", 
      RowBox[{"-", "0.13777777777777778`"}], "0.7637629629629632`"},
     {"0.4666666666666667`", 
      RowBox[{"-", "0.13777777777777778`"}], "0.7637629629629632`", 
      RowBox[{"-", "0.6604404938271606`"}]},
     {"0", "0.20000000000000004`", 
      RowBox[{"-", "0.21333333333333337`"}], "1.3327555555555561`"},
     {"0.20000000000000004`", 
      RowBox[{"-", "0.21333333333333337`"}], "1.3327555555555561`", 
      RowBox[{"-", "2.2080859259259267`"}]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.821496033914917*^9, 3.821496048638586*^9}, 
   3.821840706978795*^9, {3.821840764084361*^9, 3.821840838437653*^9}, {
   3.821841550621168*^9, 3.8218415578793488`*^9}, 3.821841602027829*^9, 
   3.8218417812598267`*^9, 3.821847089253667*^9, 3.821849558859353*^9, {
   3.821851706983953*^9, 3.821851729999457*^9}, 3.821851768775785*^9, 
   3.821852124774168*^9, 3.821852374218144*^9, 3.821852903218389*^9, 
   3.821852954606717*^9, 3.821853072313353*^9, 3.821853131592966*^9, 
   3.821853285616269*^9, {3.821853317626055*^9, 3.821853335102499*^9}, {
   3.8218537812185783`*^9, 3.82185379121292*^9}, 3.821853850403129*^9, 
   3.82185401670907*^9, 3.821854341024315*^9, 3.821854580537819*^9, 
   3.8218546387157*^9, 3.821854685057962*^9, 3.8218547604681683`*^9, 
   3.821854872650443*^9, 3.821855093585011*^9, 3.8218551434129763`*^9, 
   3.821855273745719*^9, 3.821855672015637*^9, 3.8218559881577806`*^9, 
   3.821859191344366*^9},
 CellLabel->
  "Out[28]//MatrixForm=",ExpressionUUID->"08e4b42d-563a-4a5e-983b-\
39c87c0b5c6e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Calculate", " ", "rank", " ", "of", " ", "Controlability", " ", 
    RowBox[{"matrix", ".", " ", "If"}], " ", "4", " ", "system", " ", "is", 
    " ", "controllable"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"MatrixRank", "[", "Ctrb", "]"}]}]], "Input",
 CellChangeTimes->{{3.800376876052154*^9, 3.800376876052808*^9}, {
  3.821495945865037*^9, 3.821495979720203*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"6f7c0106-4cb5-4645-8017-5becf116f093"],

Cell[BoxData["4"], "Output",
 CellChangeTimes->{{3.821496034111617*^9, 3.821496049322198*^9}, 
   3.821840707181304*^9, {3.8218407648308353`*^9, 3.821840839118722*^9}, {
   3.821841550814323*^9, 3.821841558624024*^9}, 3.82184160265059*^9, 
   3.821841781902999*^9, 3.8218470899928017`*^9, 3.8218495595139437`*^9, {
   3.821851707259673*^9, 3.821851730282254*^9}, 3.821851768978602*^9, 
   3.8218521250092287`*^9, 3.821852374879799*^9, 3.8218529035498047`*^9, 
   3.821852955186698*^9, 3.8218530727963943`*^9, 3.8218531321279497`*^9, 
   3.821853287755745*^9, {3.8218533198877783`*^9, 3.821853337187049*^9}, {
   3.821853781687901*^9, 3.821853792202977*^9}, 3.821853851322212*^9, 
   3.8218540172170353`*^9, 3.8218543432249813`*^9, 3.821854581098496*^9, 
   3.821854639179455*^9, 3.821854685521875*^9, 3.8218547609595613`*^9, 
   3.821854874826219*^9, 3.821855094028964*^9, 3.821855143917642*^9, 
   3.821855274564782*^9, 3.821855672516159*^9, 3.821855988627719*^9, 
   3.821859191620879*^9},
 CellLabel->"Out[29]=",ExpressionUUID->"4f4a27f4-8ef2-4851-b9af-cd8be51859f2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Calculate", " ", "Eigenvalues", " ", "of", " ", "Jacobian", " ", "of", 
    " ", "Undriven", " ", "system", " ", "around", " ", "equlibrium"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Eigenvalues", "[", "Acontrol", "]"}]}]], "Input",
 CellChangeTimes->{{3.800376872608163*^9, 3.800376872608869*^9}, 
   3.821495992836338*^9, 3.821840699556737*^9},
 CellLabel->"In[30]:=",ExpressionUUID->"5ee12b25-9e11-41f0-8813-14f750785f7c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "2.793440582206099`"}], ",", "2.066631200176083`", ",", 
   RowBox[{"-", "0.33985728463665177`"}], ",", "0.`"}], "}"}]], "Output",
 CellChangeTimes->{{3.8214960341527863`*^9, 3.821496049366563*^9}, {
   3.821840702507667*^9, 3.8218407072224913`*^9}, {3.821840764870034*^9, 
   3.821840839157784*^9}, {3.821841550851019*^9, 3.82184155866226*^9}, 
   3.821841602687934*^9, 3.821841781939714*^9, 3.821847090031599*^9, 
   3.821849559531316*^9, {3.8218517073008633`*^9, 3.821851730327488*^9}, 
   3.821851769019574*^9, 3.82185212502967*^9, 3.8218523748932447`*^9, 
   3.821852903653164*^9, 3.8218530729371433`*^9, 3.8218531323025208`*^9, 
   3.821853290993012*^9, {3.821853323152588*^9, 3.821853340393189*^9}, {
   3.821853781838254*^9, 3.8218537923343563`*^9}, 3.821853851443578*^9, 
   3.821854017359613*^9, 3.82185434644312*^9, 3.821854581252413*^9, 
   3.821854639308573*^9, 3.821854685672563*^9, 3.821854761115198*^9, 
   3.821854878027837*^9, 3.8218550941454268`*^9, 3.821855144072604*^9, 
   3.821855274847707*^9, 3.8218556727755003`*^9, 3.821855988757698*^9, 
   3.821859191666368*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"8d46c756-71db-479b-96a5-68ba4691d0ef"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Quit", "[", "]"}]], "Input",
 CellChangeTimes->{{3.800377578863256*^9, 3.8003776149728107`*^9}, {
  3.821495987311431*^9, 3.821496016045923*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"94051331-ad49-40b1-bc31-8875da52095f"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.800376785031851*^9, 3.800376785032681*^9}, {
   3.800377166297752*^9, 3.800377173601493*^9}, 3.821495953093192*^9, 
   3.821495985233692*^9},ExpressionUUID->"2a9211b0-50b9-490a-a2d2-\
6cbe937aa827"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8003776382255287`*^9, 3.800377672179303*^9}, {
   3.800377735165676*^9, 3.800377745776536*^9}, 3.821469116310465*^9, {
   3.821493226916335*^9, 3.8214932323348017`*^9}, 
   3.821495991420559*^9},ExpressionUUID->"055995db-4ae5-49d8-a1d3-\
39ebdba027a4"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8214474436764803`*^9, 3.821447443759522*^9}, 
   3.8214960128526154`*^9},ExpressionUUID->"e1a9c200-6cd5-45a4-916a-\
664dbcdb043b"],

Cell[BoxData[""], "Input",ExpressionUUID->"dda95d82-f7da-48c2-b391-ecf4401af7a4"]
},
WindowSize->{1670, 966},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules->{"TryRealOnly" -> False},
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (March 13, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"69de2c86-b1ab-463e-89ef-071e8a33aafd"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1215, 22, 219, "Text",ExpressionUUID->"ec91ef16-069f-48b2-a28e-a4775a03f67b"],
Cell[1776, 44, 14952, 325, 880, "Input",ExpressionUUID->"c7722910-f3b0-4675-964e-01f4d4cdef49"],
Cell[16731, 371, 246, 3, 30, "Input",ExpressionUUID->"ca78a879-afda-42fa-a41f-470ecb58234f"],
Cell[16980, 376, 3829, 95, 115, "Input",ExpressionUUID->"e6cc7a8f-e013-41b6-a344-daca8d490ae3"],
Cell[20812, 473, 1564, 35, 94, "Input",ExpressionUUID->"3da3870a-8e6e-4c0c-9a4c-a1a216d8a606"],
Cell[22379, 510, 1294, 18, 73, "Input",ExpressionUUID->"cf85ab20-42c3-49aa-ad10-a57d6f6d2187"],
Cell[23676, 530, 169, 2, 30, "Input",ExpressionUUID->"64b2b300-ae4d-4232-b82e-2a6b5e7024e5"],
Cell[CellGroupData[{
Cell[23870, 536, 1334, 29, 94, "Input",ExpressionUUID->"2563e24a-08ee-4a8f-9570-719da7f728fa"],
Cell[25207, 567, 6375, 152, 144, "Output",ExpressionUUID->"d7cfc8fa-b68d-4445-baab-5dac82ceff8f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[31619, 724, 1829, 41, 73, "Input",ExpressionUUID->"9d38b20d-5c57-40a4-812d-f344a662c428"],
Cell[33451, 767, 1460, 33, 94, "Output",ExpressionUUID->"fe28630d-fcf3-4bda-87bc-10258f281217"]
}, Open  ]],
Cell[34926, 803, 2107, 49, 178, "Input",ExpressionUUID->"61a68d14-52e8-4781-9dad-7665c22f2213"],
Cell[37036, 854, 1864, 39, 115, "Input",ExpressionUUID->"d4f7a19e-8161-47cd-8759-21d92bd641a6"],
Cell[38903, 895, 225, 3, 30, "Input",ExpressionUUID->"a3b39778-d0eb-482e-a892-b655b50450ec"],
Cell[CellGroupData[{
Cell[39153, 902, 1923, 37, 52, "Input",ExpressionUUID->"dcece8d0-22ba-4f6e-8861-b98a73b9af83"],
Cell[41079, 941, 1992, 40, 94, "Output",ExpressionUUID->"08e4b42d-563a-4a5e-983b-39c87c0b5c6e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43108, 986, 503, 9, 52, "Input",ExpressionUUID->"6f7c0106-4cb5-4645-8017-5becf116f093"],
Cell[43614, 997, 1070, 15, 34, "Output",ExpressionUUID->"4f4a27f4-8ef2-4851-b9af-cd8be51859f2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44721, 1017, 490, 10, 52, "Input",ExpressionUUID->"5ee12b25-9e11-41f0-8813-14f750785f7c"],
Cell[45214, 1029, 1224, 19, 34, "Output",ExpressionUUID->"8d46c756-71db-479b-96a5-68ba4691d0ef"]
}, Open  ]],
Cell[46453, 1051, 248, 4, 30, "Input",ExpressionUUID->"94051331-ad49-40b1-bc31-8875da52095f"],
Cell[46704, 1057, 247, 4, 30, "Input",ExpressionUUID->"2a9211b0-50b9-490a-a2d2-6cbe937aa827"],
Cell[46954, 1063, 301, 5, 30, "Input",ExpressionUUID->"055995db-4ae5-49d8-a1d3-39ebdba027a4"],
Cell[47258, 1070, 179, 3, 30, "Input",ExpressionUUID->"e1a9c200-6cd5-45a4-916a-664dbcdb043b"],
Cell[47440, 1075, 81, 0, 30, "Input",ExpressionUUID->"dda95d82-f7da-48c2-b391-ecf4401af7a4"]
}
]
*)

